<!DOCTYPE html>
<html>
	<head>

		<title>{{title}}</title>

		<script type="text/javascript" src="javascripts/jquery-3.1.0.min.js"></script>
		<script type="text/javascript" src="javascripts/socket.io-1.4.5.js"></script>

	</head>

	<body>

		<p>Numbers:</p>

		<ul id="numbers">
			<li id="buy">Buy new number</li>
		</ul>

		<p>Messages:</p>

		<ul id="messages"></ul>

		<input id="m" autocomplete="off" />

		<input id="to" autocomplete="off" />
		<input id="from" autocomplete="off" />

		<button id="button" value="">Send</button>

	</body>

</html>

<script>

	//
	//	Create a Socket.IO object
	//
	var socket = io();

	//
	//	Render account numbers
	//
	socket.on('number', function(msg) {

		$('#numbers').append($('<li>').text(msg).append($('<ul>')))

	});

	//
	//	Render
	//
	socket.on('fromNumber', function(msg) {

		$("ul li:contains('" + msg.to + "') > ul").append($('<li class="number">').text(msg.from))

	});

	//
	//	Receive a message
	//
	socket.on('message', function(msg) {

		$('#messages').append($('<li>').text(msg));

	});

	socket.on('bought', function(msg) {

		$('#numbers').append($('<li class="number">').text(msg));

	});


	//
	//	Send a message
	//
	$('#button').click(function() {

		var to = $('#to').val();
		var from = $('#from').val();
		var message = $('#m').val();

		var obj = {
			to: to,
			from: from,
			message: message
		};

		socket.emit('sendMessage', obj);

		$('#m').val('');

	});

	$('#numbers').on("click", '.number', function() {

		var to = $(this).text();
		var from = $(this).parent()
						  .parent()
						  .clone()    //clone the element
						  .children() //select all the children
						  .remove()   //remove all the children
						  .end()  //again go back to selected element
						  .text()


		$('#to').val(to);
		$('#from').val(from);
		$('#messages').empty();

		var obj = {
			to: to,
			from: from
		}

		socket.emit('messages', obj);

	});

	$('#numbers').on("click", '#buy', function() {

		socket.emit('buy');

	});

</script>